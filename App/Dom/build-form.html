<script>

function createLabel(label){
    const labelElement = document.createElement('span')
    labelElement.setAttribute('class', 'label')
    labelElement.innerText = label
    return labelElement
    // TODO test if this can be done with method chaining
}

function createCell(value){
    // TODO handle if value is list
    const cellElement = document.createElement('span')
    cellElement.setAttribute('class', 'cell')
    cellElement.innerText = value
    return cellElement
}

function createTextBox(name){
    const inputElement = document.createElement('input')
    inputElement.setAttribute('class', 'input')
    inputElement.setAttribute('type', 'text')
    inputElement.setAttribute('id', name + "-input")
    return inputElement
}

function createUpdateButton(name, type, value, index, inputElement) {
    const updateButton = document.createElement('button');
    updateButton.innerText = 'update'
    updateButton.setAttribute('class', 'update-button')

    updateButton.addEventListener('click', () => {
        let value = document.getElementById(name + "-input").value
        if (value == "") return

        sendUpdate( {index: index, name: name, type: type, value: value} )
        // TODO, is type needed?? Can't it be inferred on the other side? or
        // is redundancy here ok?
    })

    return updateButton;
}

function createInputContainer(name, type, value, index) {
    const label = createLabel(name)
    const cell = createCell(value)
    const textBox = createTextBox(name)
    const button = createUpdateButton(name, value, index, textBox)

    const inputContainer = document.createElement('div')
    inputContainer.setAttribute('class', 'input-container')
    inputContainer.append(label, cell, textBox, button)
    return inputContainer
}


function buildForm(day) {
    console.log("starting to build form")
    console.log(day)

    const form = document.createElement('div')
    form.setAttribute('class', 'form')

    console.log("about to build elemetns in form")

    day.fields.forEach(field => {
        if (field.type != "index" && field.type != "calc") {
            let row = createInputContainer(
                field.name,
                field.type,
                day[field.name],
                day.index
                )
            form.appendChild(row)
        }
    })
    return form
}



</script>